http {
    map $http_upgrade $connection_upgrade {
        default upgrade;
        '' close;
    }

    upstream kicker_api {
        server                      127.0.0.1:8888;
    }

    upstream kicker_socket {
        server                      127.0.0.1:8889;
    }

    server {
        listen                      80;
        server_name                 kicker.lan kicker.servebeer.com kicker.rom4.ru;

        charset utf-8;
        client_max_body_size        15M;
        client_body_buffer_size     15M;

        location /api/ {
            proxy_set_header        X-Real-IP $remote_addr;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header        Host $http_host;
            proxy_set_header        X-NginX-Proxy true;

            proxy_pass              http://kicker_api;
            proxy_redirect          off;
        }

        location /socket.io/ {
            proxy_set_header        X-Real-IP $remote_addr;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header        Host $http_host;
            proxy_set_header        X-NginX-Proxy true;

            proxy_http_version      1.1;
            proxy_set_header        Upgrade $http_upgrade;
            proxy_set_header        Connection $connection_upgrade;
            proxy_pass              http://kicker_socket;
            proxy_redirect          off;
        }

        index index.html;

        location / {
            root                    /home/gorod/kicker_client/current/build;
            try_files               $uri $uri$args $uri$args/ $uri/ /index.html;
        }
    }
}
